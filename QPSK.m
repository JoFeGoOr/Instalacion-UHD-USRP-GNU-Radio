clear
clc


M = 4;                 % Modulation alphabet
k = log2(M);           % Bits/symbol
numSC = 52;            % Number of OFDM subcarriers
cpLen = 16;            % OFDM cyclic prefix length
maxBitErrors = 100;    % Maximum number of bit errors
maxNumBits = 1e7;      % Maximum number of bits transmitted

ofdmMod = comm.OFDMModulator('FFTLength',numSC,'CyclicPrefixLength',cpLen);
ofdmDims = info(ofdmMod);
numDC = ofdmDims.DataInputSize(1);

EbNoVec = (0:10)';
snrVec = EbNoVec + 10*log10(k) + 10*log10(numDC/numSC);

berTheory = berawgn(EbNoVec,'psk',M,'nondiff');

exp=[0.0807926829268293,0.0640243902439024,0.0376940133037694,0.0210830921868541,0.0148398471936527,0.00662208234985576,0.00221132372903621,0.000833714771464069,0.000176235129070421,3.61395257635459e-05,4.19997312017203e-06;0.0837398373983740,0.0648267008985879,0.0365853658536585,0.0232397606994938,0.0133752950432730,0.00612789709986652,0.00185934594771957,0.000690418899704692,0.000189376893768938,3.40589347714072e-05,3.39997824013926e-06;0.0829268292682927,0.0551431601272535,0.0333761232349166,0.0230352303523035,0.0119583234667298,0.00524130773222626,0.00228517127471831,0.000640513425415065,0.000182908719494085,3.64194948868472e-05,4.09997376016794e-06;0.0800304878048781,0.0640243902439024,0.0345528455284553,0.0216089002995293,0.0119583234667298,0.00669406150583245,0.00256072207291720,0.000698642834414731,0.000170384191046226,3.50384694641473e-05,4.29997248017613e-06;0.0807926829268293,0.0661103979460847,0.0351916376306620,0.0228093947606143,0.0109000647528599,0.00502737680438029,0.00206662301522344,0.000727959407253647,0.000229839021659483,3.23775647198668e-05,3.09998016012698e-06;0.0738880918220947,0.0546129374337222,0.0376940133037694,0.0212363330529857,0.0120767227089747,0.00537863457237192,0.00274322342332555,0.000697456011932713,0.000160944376985910,3.29474458878978e-05,3.79997568015565e-06;0.0800304878048781,0.0540827147401909,0.0312314098750744,0.0259146341463415,0.0124414880512441,0.00547425474254743,0.00182475158084914,0.000639847956921128,0.000188392064403972,3.39603329861085e-05,5.39996544022118e-06;0.0711382113821138,0.0540827147401909,0.0345528455284553,0.0222125435540070,0.0119583234667298,0.00651696993160408,0.00214209968186638,0.000736226728674938,0.000185191297109182,2.82042389016320e-05,4.29997248017613e-06;0.0888501742160279,0.0492682926829268,0.0401258851298190,0.0207317073170732,0.0129653401797176,0.00562423432453503,0.00281211716226751,0.000814082826882466,0.000146075345952701,3.34848661666260e-05,3.19997952013107e-06;0.0845528455284553,0.0592334494773519,0.0372822299651568,0.0236866791744841,0.0118433395872420,0.00575564166856622,0.00239212007504690,0.000780549630591363,0.000198023684416908,3.44446801385154e-05,5.29996608021709e-06;];

gnu =[0.0553861788617886,0.0373244641537324,0.0197444831591173,0.00805037462139327,0.00388551204124029,0.00183017431957380,0.000458907346152448,0.000107836396171701,1.85155106816164e-05,1.69998912006963e-06,1.99998720008192e-07;0.0565410199556541,0.0369440459110473,0.0188470066518847,0.00872289972899729,0.00515358710072456,0.00196758357359931,0.000551099470726251,9.70765539937871e-05,1.91469992860634e-05,2.59998336010650e-06,0;0.0497560975609756,0.0300416418798334,0.0166446934739618,0.00962271341463415,0.00461313601900064,0.00168958479708254,0.000448576429507533,0.000115231295450760,1.62651011802022e-05,1.09999296004506e-06,9.99993600040960e-08;0.0492682926829268,0.0293263646922184,0.0165853658536585,0.0125684420109507,0.00416117336849044,0.00144228023076484,0.000525248322845702,0.000111973392461197,1.63895480768731e-05,1.09999296004506e-06,0;0.0512195121951220,0.0365853658536585,0.0201919232307077,0.00912375790424571,0.00484924140579989,0.00190666767348788,0.000560121563016449,0.000114173833618203,2.05140954177604e-05,1.99998720008192e-06,0;0.0540827147401909,0.0307926829268293,0.0195509097948122,0.0105274129664374,0.00507715281234445,0.00155322486390059,0.000538333617601910,0.000127664522913886,1.55662077049954e-05,2.39998464009830e-06,2.99998080012288e-07;0.0497560975609756,0.0293791574279379,0.0192454268292683,0.00993312352478364,0.00526370648321868,0.00172266757632611,0.000586527293844367,0.000125864226146860,2.25947446860964e-05,2.29998528009421e-06,9.99993600040960e-08;];

figure
semilogy(EbNoVec,berTheory,'Color','Red')
hold on
for m = 1:size(exp,1)
    semilogy(EbNoVec,exp(m,:),'*','Color','blue')
end
for m = 1:size(gnu,1)
    semilogy(EbNoVec,gnu(m,:),'+','Color','Green')
end
legend('Teoria','Simulacion Matlab','','','','','','','','','','Simulacion GNU')
xlabel('Eb/No (dB)')
ylabel('Bit Error Rate')
grid on
hold off